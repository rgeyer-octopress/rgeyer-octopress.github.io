<h2>date: 2010-08-02 00:00:00 -0700</h2>

<p>layout: post
title: RightScriptDiff &ndash; Maintain your RightScripts Locally
comments: true
categories:
&ndash; Cloud computing
&ndash; Linux
tags:
&ndash; API
&ndash; cloud
&ndash; compare
&ndash; diff
&ndash; linkedin
&ndash; RightScale
&ndash; RightScript
&ndash; rsDiff
status: publish
type: post
published: true
meta:
  <em>edit_last: &lsquo;1&rsquo;
  </em>syntaxhighlighter_encoded: &lsquo;1&rsquo;
  <em>sexybookmarks_shortUrl: <a href="http://b2l.me/aemxqq">http://b2l.me/aemxqq</a>
  </em>sexybookmarks_permaHash: 370ff92d5aa793f192c0c3a5d603e7d3</p>

<h2>date: 2010-08-02 00:00:00 -0700</h2>

<p>If you&rsquo;re running servers in the cloud, particularly on Amazon&rsquo;s AWS and haven&rsquo;t heard about <a href="http://www.rightscale.com">RightScale</a> you owe it to yourself to check them out.  I&rsquo;ve been using their tools for launching and managing linux servers on AWS.  They allow you to automate all of the tasks to launch a new box, and even run regular operational tasks, all with the use of RightScripts.</p>

<p>RightScripts are just glorified shell scripts which get downloaded from RightScale to your linux server running in any of the clouds they support, and executed with the parameters that you specify in the RightScale dashboard for that RightScript.  Of course, as you start to get into more complex scenarios you&rsquo;re likely to start writing and testing your scripts locally before saving them in the RightScale dashboard.  That&rsquo;s where RightScriptDiff comes in.</p>

<!--more-->


<p>The only way to create or edit a RightScript as of this writing is through the RightScale dashboard.  So you&rsquo;re typing your script into a nice big textarea, where you can&rsquo;t tab for indents or any of the other benefits you get from an editor like vim, emacs, or even <em>gasp</em> notepad.exe.  As a result I started to write, and even test my scripts locally before I ever committed them to RightScale.</p>

<p>Going this route of course adds a fair amount of overhead to the process.  You have to remember which scripts you&rsquo;ve edited, then copy/paste them into the RightScale dashboard to update the script in their system.  After a while I found I couldn&rsquo;t keep up with the overhead, and I needed to find some good way to compare my local copies of scripts with the ones in my RightScale dashboard.</p>

<p>Thus was born RightScriptDiff.  By supplying RightScriptDiff with your username, password, and account id for RightScale along with a path to a directory containing your local scripts, it will use the RightScale API to compare your local copy against the one stored in your RightScale account.  If you&rsquo;re thinking &ldquo;why don&rsquo;t you just synchronize the script using the API&rdquo;, you&rsquo;re on the right track.  Sadly, the API doesn&rsquo;t (yet) support RightScripts for anything but viewing, here&rsquo;s hoping they open up that functionality a bit.</p>

<p>In order for RightScriptDiff to compare your local files, they must be named with a specific pattern, namely &lt;rightscript_id&gt;&ndash;&lt;rightscript_name&gt;.sh.  Actually, the script name and the <em>.sh extension are optional, but that&rsquo;s the convention I use so it&rsquo;s easier to identify them.  You can pass (almost) any argument to RightScriptDiff that you can to the &ldquo;ls&rdquo; command in </em>nix and OSX, so something like <em>relative/path/to/RightScripts/*.sh</em> is totally acceptable.  This means you can also target just a single script if you&rsquo;d like.  RightScriptDiff uses the RightScript_ID section of the filename to look up the script using the RightScript API, then compares the script against your local copy.  If they&rsquo;re the same, you get a happy success message that there is no difference.  If the files are different, a side by side diff is shown.</p>

<p>Here&rsquo;s an example of a successful run;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Ryan-Geyers-MacBook-Pro:RightScripts rgeyer$ rsDiff.sh
</span><span class='line'>Please enter the path to scripts stored locally...
</span><span class='line'>*.sh
</span><span class='line'>Grabbing all RightScripts for user: ***** on account: *****.  Be patient, this could take a while...
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100  369k  100  369k    0     0   148k      0  0:00:02  0:00:02 --:--:--  182k
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 236067-LDAP Install OpenLDAP.sh does not differ from RightScale copy.
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 237784-LDAP Create Database.sh does not differ from RightScale copy.
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 237788-LDAP Set Config Admin Details.sh does not differ from RightScale copy.
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 237789-LDAP Tools Install.sh does not differ from RightScale copy.
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 238408-LDAP Enable Schema(s).sh does not differ from RightScale copy.
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 238454-LDAP DB S3 Backup.sh does not differ from RightScale copy.
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 238480-LDAP DB S3 Restore.sh does not differ from RightScale copy.
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 238481-LDAP DB S3 Enable Continuous Backup.sh does not differ from RightScale copy.
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 238497-LDAP DB S3 Disable Continuous Backup.sh does not differ from RightScale copy.</span></code></pre></td></tr></table></div></figure>


<p>This is what it looks like when the scripts differ;</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>Ryan-Geyers-MacBook-Pro:RightScripts rgeyer$ rsDiff.sh
</span><span class='line'>Please enter the path to scripts stored locally...
</span><span class='line'>237784*.sh
</span><span class='line'>Grabbing all RightScripts for user: ***** on account: *****.  Be patient, this could take a while...
</span><span class='line'>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span><span class='line'>                                 Dload  Upload   Total   Spent    Left  Speed
</span><span class='line'>100  369k  100  369k    0     0   172k      0  0:00:02  0:00:02 --:--:--  220k
</span><span class='line'>Found 1 nodes:
</span><span class='line'>-- NODE --
</span><span class='line'>
</span><span class='line'>Local copy of 237784-LDAP Create Database.sh differs from RightScale copy.. Diff below..
</span><span class='line'>                                &gt;  sed -i &quot;s/@@DATABASE_TYPE@@/$DATABASE_TYPE/g&quot; $tmp_file
</span><span class='line'>                                &gt;  sed -i &quot;s/@@DB_CHECKPOINT@@/$DB_CHECKPOINT/g&quot; $tmp_file
</span><span class='line'>                                &lt;
</span><span class='line'>echo &quot;Finishing up...&quot;</span></code></pre></td></tr></table></div></figure>


<p>As mentioned above RightScriptDiff requires three values, your RightScale account email address, password, and account number.  You might notice that in both instances above I did not need to provide them and was prompted only for the path to my scripts.  This is because I pre-defined my credentials and account before hand.   There are a couple ways to provide this to RightScriptDiff, you can call rsDiff.sh with parameters (-e|&mdash;email=)&lt;email-address&gt; (-p|&mdash;password=)&lt;password&gt; (-a|&mdash;account_id=)&lt;account_id&gt;, or you can rename the supplied rsDiffAuth.sh.example file, to rsDiffAuth.sh and put your credentials in there.</p>

<p>After developing this, I discovered that I had edited one of my script files locally and the change wasn&rsquo;t reflected in my RightScale dashboard, so it&rsquo;s already proved useful to me.  Hopefully this helps some other sysadmins building our their RightScale managed clouds.</p>

<p>You can download RightScriptDiff by running the following command.  I wrote it on OSX 10.6.4, but it should work on most flavors of linux as well.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>svn export https://linode.nslms.com/svn_ro/RightScriptDiff/</span></code></pre></td></tr></table></div></figure>


<p><em><strong><span style="color: #ff0000;">* UPDATE: RightScriptDiff has a new home</span></strong></em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>git clone git://github.com/rgeyer/RightScriptDiff.git</span></code></pre></td></tr></table></div></figure>


<p>Chances are pretty good I&rsquo;ll create a landing page for this, particularly if it becomes popular, so stay tuned here for updates!</p>
